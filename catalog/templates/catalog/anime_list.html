{% extends "base.html" %}

{% block title %}
  Anime
{% endblock %}

{% block css %}
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/card.css' %}">
{% endblock %}

{% block content %}
  {% if anime_list %}
    <section class="card-container">
      {% for anime in anime_list %}
        {% if anime.status == 'air' %}
          <article class="mycard">
            <header class="card__title">
              <h5><a href="{% url 'anime-detail' anime.pk %}">{{ anime.title }}</a></h5>
            </header>

            <figure class="card__thumbnail">
              <img src="{{ anime.image_url }}" alt="">
            </figure>

            <main class="card__description">
              {{ anime.get_short_synopsis }}
              ...
              <br><a href="{% url 'anime-detail' anime.pk %}">Read more</a>
            </main>

            {% if user.is_authenticated %}
              <!-- Check if user already has the anime in their watchlist -->
              {% if anime in watchlist %}
                <button type="button" class="update-watchlist" id="{{ anime.pk }}" style="background: red">Remove from watchlist</button>
              {% else %}
                <button type="button" class="update-watchlist" id="{{ anime.pk }}" style="background: green">Add to watchlist</button>
              {% endif %}
            {% endif %}
          </article>
        {% endif %}
      {% endfor %}
    </section>

  {% else %}
    <p>There are no anime in the database.</p>
  {% endif %}
{% endblock %}

{% block scripts %}
  <!-- ajax for update watchlist buttons -->
  <script>
  $('.update-watchlist').click(function(){
      $.ajax({
          type: "POST",
          url: "{% url "update-watchlist" %}",
          data: {'anime_id': $(this).attr('id'), 'csrfmiddlewaretoken': '{{ csrf_token }}'},
          dataType: "json",
          success: function(response) {
              let selector = document.getElementById(response.anime_id)
              if(response.added === true){
                  $(selector).css("background","red");
                  $(selector).html("Remove from watchlist");
              }
              else if(response.added === false){
                  $(selector).css("background","green");
                  $(selector).html("Add to watchlist");
              }
          },
      });
  })
  </script>
{% endblock %}